import{p as P,a as T,b as v,d as b,v as k,w as I}from"./bootstrap-Dqimdg2y.js";import{s as j}from"./pos-section-switch-DmfccXVX.js";import{_ as p,n as V}from"./currency-Dtag6qPd.js";import{n as O}from"./ns-prompt-popup-B8C9prFY.js";import{_ as C}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{r as x,o as l,c as n,a as e,t as d,f as y,B as S,F as _,b as g,e as u,n as w,i as m,w as L}from"./runtime-core.esm-bundler-DYLTeUDs.js";import"./chart-D2s_fKm5.js";const H={name:"ns-pos-search-product",props:["popup"],data(){return{searchValue:"",products:[],isLoading:!1,debounce:null}},watch:{searchValue(){clearTimeout(this.debounce),this.debounce=setTimeout(()=>{this.search()},500)}},mounted(){this.$refs.searchField.focus(),this.$refs.searchField.addEventListener("keydown",s=>{s.keyCode===27&&this.popupResolver(!1)}),this.popupCloser()},methods:{__:p,popupCloser:P,popupResolver:T,addToCart(s){if(this.popup.close(),parseInt(s.accurate_tracking)===1)return Popup.show(O,{title:p("Unable to add the product"),message:p(`The product "{product}" can't be added from a search field, as "Accurate Tracking" is enabled. Would you like to learn more ?`).replace("{product}",s.name),onAction:t=>{t&&window.open("https://my.nexopos.com/en/documentation/troubleshooting/accurate-tracking","_blank")}});POS.addToCart(s)},search(){this.isLoading=!0,v.post("/api/products/search",{search:this.searchValue}).subscribe({next:s=>{if(this.isLoading=!1,this.products=s,this.products.length===1&&this.addToCart(this.products[0]),this.products.length===0)return b.info(p("No result to result match the search value provided.")).subscribe()},error:s=>{this.isLoading=!1,b.error(s.message).subscribe()}})}}},W={id:"product-search",class:"ns-box shadow-lg w-95vw h-95vh md:h-3/5-screen md:w-2/4-screen flex flex-col overflow-hidden"},B={class:"p-2 border-b ns-box-header flex justify-between items-center"},F={class:"text-primary"},N={class:"flex-auto overflow-hidden flex flex-col"},U={class:"p-2 border-b ns-box-body"},q={class:"flex input-group info border-2 rounded overflow-hidden"},A={class:"overflow-y-auto ns-scrollbar flex-auto relative"},z={class:"ns-vertical-menu"},E=["onClick"],D={class:""},M={class:"text-primary"},G={class:"text-soft-secondary text-xs"},K=e("div",null,null,-1),R={key:0},J={class:"text-primary text-center p-2"},Q={key:1,class:"absolute h-full w-full flex items-center justify-center z-10 top-0",style:{background:"rgb(187 203 214 / 29%)"}};function X(s,t,c,h,o,i){const f=x("ns-close-button"),r=x("ns-spinner");return l(),n("div",W,[e("div",B,[e("h3",F,d(i.__("Search Product")),1),e("div",null,[y(f,{onClick:t[0]||(t[0]=a=>c.popup.close())})])]),e("div",N,[e("div",U,[e("div",q,[S(e("input",{onKeyup:t[1]||(t[1]=I(a=>i.search(),["enter"])),"onUpdate:modelValue":t[2]||(t[2]=a=>o.searchValue=a),ref:"searchField",type:"text",class:"p-2 outline-none flex-auto text-primary"},null,544),[[k,o.searchValue]]),e("button",{onClick:t[3]||(t[3]=a=>i.search()),class:"px-2"},d(i.__("Search")),1)])]),e("div",A,[e("ul",z,[(l(!0),n(_,null,g(o.products,a=>(l(),n("li",{key:a.id,onClick:Je=>i.addToCart(a),class:"cursor-pointer p-2 flex justify-between border-b"},[e("div",D,[e("h2",M,d(a.name),1),e("small",G,d(a.category.name),1)]),K],8,E))),128))]),o.products.length===0?(l(),n("ul",R,[e("li",J,d(i.__("There is nothing to display. Have you started the search ?")),1)])):u("",!0),o.isLoading?(l(),n("div",Q,[y(r)])):u("",!0)])])])}const Y=C(H,[["render",X]]),Z={name:"ns-pos-grid",data(){return{items:Array.from({length:1e3},(s,t)=>({data:"#"+t})),products:[],categories:[],breadcrumbs:[],barcode:"",previousCategory:null,order:null,visibleSection:null,breadcrumbsSubsribe:null,orderSubscription:null,visibleSectionSubscriber:null,currentCategory:null,settings:{},settingsSubscriber:null,options:!1,optionsSubscriber:null,interval:null,searchTimeout:null,gridItemsWidth:0,gridItemsHeight:0,isLoading:!1}},computed:{hasCategories(){return this.categories.length>0},hasProducts(){return this.products.length>0},createCategoryUrl(){return POS.settings.getValue().urls.categories_url}},watch:{options:{handler(){this.options.ns_pos_force_autofocus&&(clearTimeout(this.searchTimeout),this.searchTimeout=setTimeout(()=>{this.submitSearch(this.barcode)},200))},deep:!0},barcode(){this.options.ns_pos_force_autofocus&&(clearTimeout(this.searchTimeout),this.searchTimeout=setTimeout(()=>{this.submitSearch(this.barcode)},200))}},mounted(){this.loadCategories(),this.settingsSubscriber=POS.settings.subscribe(s=>{this.settings=s,this.$forceUpdate()}),this.optionsSubscriber=POS.options.subscribe(s=>{this.options=s,this.$forceUpdate()}),this.breadcrumbsSubsribe=POS.breadcrumbs.subscribe(s=>{this.breadcrumbs=s,this.$forceUpdate()}),this.visibleSectionSubscriber=POS.visibleSection.subscribe(s=>{this.visibleSection=s,this.$forceUpdate()}),this.orderSubscription=POS.order.subscribe(s=>this.order=s),this.interval=setInterval(()=>this.checkFocus(),500);for(let s in nsShortcuts)["ns_pos_keyboard_quick_search"].includes(s)&&nsHotPress.create("search-popup").whenNotVisible([".is-popup","#product-search"]).whenPressed(nsShortcuts[s]!==null?nsShortcuts[s].join("+"):null,t=>{t.preventDefault(),this.openSearchPopup()}),["ns_pos_keyboard_toggle_merge"].includes(s)&&nsHotPress.create("toggle-merge").whenNotVisible([".is-popup"]).whenPressed(nsShortcuts[s]!==null?nsShortcuts[s].join("+"):null,t=>{t.preventDefault(),this.posToggleMerge()})},unmounted(){this.orderSubscription.unsubscribe(),this.breadcrumbsSubsribe.unsubscribe(),this.visibleSectionSubscriber.unsubscribe(),this.settingsSubscriber.unsubscribe(),this.optionsSubscriber.unsubscribe(),clearInterval(this.interval),nsHotPress.destroy("search-popup"),nsHotPress.destroy("toggle-merge")},methods:{__:p,nsCurrency:V,switchTo:j,posToggleMerge(){POS.set("ns_pos_items_merge",!this.settings.ns_pos_items_merge)},computeGridWidth(){document.getElementById("grid-items")!==null&&(this.gridItemsWidth=document.getElementById("grid-items").offsetWidth,this.gridItemsHeight=document.getElementById("grid-items").offsetHeight)},cellSizeAndPositionGetter(s,t){const c={xs:{width:this.gridItemsWidth/2,items:2,height:200},sm:{width:this.gridItemsWidth/2,items:2,height:200},md:{width:this.gridItemsWidth/3,items:3,height:150},lg:{width:this.gridItemsWidth/4,items:4,height:150},xl:{width:this.gridItemsWidth/6,items:6,height:150}},h=c[POS.responsive.screenIs].width,o=c[POS.responsive.screenIs].height,i=0;return{width:h-i,height:o,x:t%c[POS.responsive.screenIs].items*h-i,y:parseInt(t/c[POS.responsive.screenIs].items)*o}},openSearchPopup(){Popup.show(Y)},hasNoFeatured(s){return s.galleries&&s.galleries.length>0&&s.galleries.filter(t=>t.featured).length===0},submitSearch(s){if(s.length>0){const t=nsHooks.applyFilters("ns-pos-submit-search-url",`/api/products/pos/search/${s}`,s);v.get(t).subscribe({next:c=>{this.barcode="",POS.addToCart(c.product)},error:c=>{this.barcode="",b.error(c.message).subscribe()}})}},checkFocus(){this.options.ns_pos_force_autofocus&&document.querySelectorAll(".is-popup").length===0&&this.$refs.search.focus()},loadCategories(s){this.isLoading=!0,v.get(`/api/categories/pos/${s?s.id:""}`).subscribe({next:t=>{this.categories=t.categories,this.products=t.products,this.previousCategory=t.previousCategory,this.currentCategory=t.currentCategory,this.updateBreadCrumb(this.currentCategory),this.isLoading=!1},error:t=>(this.isLoading=!1,b.error(p("An unexpected error occurred.")).subscribe())})},updateBreadCrumb(s){if(s){const t=this.breadcrumb.filter(c=>c.id===s.id);if(t.length>0){let c=!0;const h=this.breadcrumb.filter(o=>o.id===t[0].id&&c?(c=!1,!0):c);this.breadcrumb=h}else this.breadcrumb.push(s)}else this.breadcrumb=[];POS.breadcrumbs.next(this.breadcrumb)},addToTheCart(s){POS.addToCart(s)}}},$={id:"pos-grid",class:"flex-auto flex flex-col"},ee={key:0,id:"tools",class:"flex pl-2"},se={key:0,class:"products-count flex items-center justify-center text-sm rounded-full h-6 w-6 ml-1"},te={id:"grid-container",class:"rounded shadow overflow-hidden flex-auto flex flex-col"},re={id:"grid-header",class:"p-2 border-b"},ie={class:"border rounded flex overflow-hidden"},oe=["title"],le=e("i",{class:"las la-search"},null,-1),ne=[le],ce=["title"],ae=e("i",{class:"las la-compress-arrows-alt"},null,-1),de=[ae],ue=["title"],he=e("i",{class:"las la-barcode"},null,-1),_e=[he],pe={style:{height:"0px"}},ge={key:0,class:"fade-in-entrance ns-loader"},be=e("div",{class:"bar"},null,-1),fe=[be],me={id:"grid-breadscrumb",class:"p-2"},ve={class:"flex"},xe=e("i",{class:"las la-angle-right"},null,-1),ye=["onClick"],we=e("i",{class:"las la-angle-right"},null,-1),ke={id:"grid-items",class:"overflow-y-auto h-full flex-col flex"},Ce={key:0,class:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5"},Se=["onClick"],Pe={class:"h-full w-full flex items-center justify-center"},Te=["src","alt"],Ie={key:1,class:"las la-image text-6xl"},je={class:"w-full absolute z-10 -bottom-10"},Ve={class:"cell-item-label relative w-full flex items-center justify-center -top-10 h-20 py-2"},Oe={class:"text-sm font-bold py-2 text-center"},Le={key:1,class:"h-full w-full flex flex-col items-center justify-center"},He=e("i",{class:"las la-frown-open text-8xl text-primary"},null,-1),We={class:"w-1/2 md:w-2/3 text-center text-primary"},Be=e("br",null,null,-1),Fe={key:2,class:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5"},Ne=["onClick"],Ue={class:"h-full w-full flex items-center justify-center overflow-hidden"},qe=["src","alt"],Ae=["src","alt"],ze={key:2,class:"las la-image text-6xl"},Ee={class:"w-full absolute z-10 -bottom-10"},De={class:"cell-item-label relative w-full flex flex-col items-center justify-center -top-10 h-20 p-2"},Me={class:"text-sm text-center w-full"},Ge={key:0,class:"text-sm"},Ke={key:0,class:"text-sm"};function Re(s,t,c,h,o,i){const f=x("ns-link");return l(),n("div",$,[o.visibleSection==="grid"?(l(),n("div",ee,[e("div",{onClick:t[0]||(t[0]=r=>i.switchTo("cart")),class:"switch-cart flex cursor-pointer rounded-tl-lg rounded-tr-lg px-3 py-2 border-t border-r border-l"},[e("span",null,d(i.__("Cart")),1),o.order?(l(),n("span",se,d(o.order.products.length),1)):u("",!0)]),e("div",{onClick:t[1]||(t[1]=r=>i.switchTo("grid")),class:"switch-grid cursor-pointer rounded-tl-lg rounded-tr-lg px-3 py-2 font-semibold"},d(i.__("Products")),1)])):u("",!0),e("div",te,[e("div",re,[e("div",ie,[e("button",{title:i.__("Search for products."),onClick:t[2]||(t[2]=r=>i.openSearchPopup()),class:"w-10 h-10 border-r outline-none"},ne,8,oe),e("button",{title:i.__("Toggle merging similar products."),onClick:t[3]||(t[3]=r=>i.posToggleMerge()),class:w([o.settings.ns_pos_items_merge?"pos-button-clicked":"","outline-none w-10 h-10 border-r"])},de,10,ce),e("button",{title:i.__("Toggle auto focus."),onClick:t[4]||(t[4]=r=>o.options.ns_pos_force_autofocus=!o.options.ns_pos_force_autofocus),class:w([o.options.ns_pos_force_autofocus?"pos-button-clicked":"","outline-none w-10 h-10 border-r"])},_e,10,ue),S(e("input",{ref:"search","onUpdate:modelValue":t[5]||(t[5]=r=>o.barcode=r),type:"text",class:"flex-auto outline-none px-2"},null,512),[[k,o.barcode]])])]),e("div",pe,[o.isLoading?(l(),n("div",ge,fe)):u("",!0)]),e("div",me,[e("ul",ve,[e("li",null,[e("a",{onClick:t[6]||(t[6]=r=>i.loadCategories()),href:"javascript:void(0)",class:"px-3"},d(i.__("Home")),1),m(),xe]),e("li",null,[(l(!0),n(_,null,g(o.breadcrumbs,r=>(l(),n("a",{onClick:a=>i.loadCategories(r),key:r.id,href:"javascript:void(0)",class:"px-3"},[m(d(r.name)+" ",1),we],8,ye))),128))])])]),e("div",ke,[i.hasCategories?(l(),n("div",Ce,[(l(!0),n(_,null,g(o.categories,r=>(l(),n("div",{onClick:a=>i.loadCategories(r),key:r.id,class:"cell-item w-full h-36 cursor-pointer border flex flex-col items-center justify-center overflow-hidden relative"},[e("div",Pe,[r.preview_url?(l(),n("img",{key:0,src:r.preview_url,class:"object-cover h-full",alt:r.name},null,8,Te)):u("",!0),r.preview_url?u("",!0):(l(),n("i",Ie))]),e("div",je,[e("div",Ve,[e("h3",Oe,d(r.name),1)])])],8,Se))),128))])):u("",!0),!i.hasCategories&&!i.hasProducts&&!o.isLoading?(l(),n("div",Le,[He,e("p",We,d(i.__("Looks like there is either no products and no categories. How about creating those first to get started ?")),1),Be,y(f,{target:"blank",type:"info",href:i.createCategoryUrl},{default:L(()=>[m(d(i.__("Create Categories")),1)]),_:1},8,["href"])])):u("",!0),i.hasCategories?u("",!0):(l(),n("div",Fe,[(l(!0),n(_,null,g(o.products,r=>(l(),n("div",{onClick:a=>i.addToTheCart(r),key:r.id,class:"cell-item w-full h-36 cursor-pointer border flex flex-col items-center justify-center overflow-hidden relative"},[e("div",Ue,[r.galleries&&r.galleries.filter(a=>a.featured).length>0?(l(),n("img",{key:0,src:r.galleries.filter(a=>a.featured)[0].url,class:"object-cover h-full",alt:r.name},null,8,qe)):i.hasNoFeatured(r)?(l(),n("img",{key:1,src:r.galleries[0].url,class:"object-cover h-full",alt:r.name},null,8,Ae)):(l(),n("i",ze))]),e("div",Ee,[e("div",De,[e("h3",Me,d(r.name),1),o.options.ns_pos_gross_price_used==="yes"?(l(),n(_,{key:0},[r.unit_quantities&&r.unit_quantities.length===1?(l(),n("span",Ge,d(i.nsCurrency(r.unit_quantities[0].sale_price_without_tax)),1)):u("",!0)],64)):u("",!0),o.options.ns_pos_gross_price_used==="no"?(l(),n(_,{key:1},[r.unit_quantities&&r.unit_quantities.length===1?(l(),n("span",Ke,d(i.nsCurrency(r.unit_quantities[0].sale_price_with_tax)),1)):u("",!0)],64)):u("",!0)])])],8,Ne))),128))]))])])])}const ts=C(Z,[["render",Re]]);export{ts as default};
